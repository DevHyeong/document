# 에러모음
제가 겪었던 에러를 모아놓은 저장소입니다. 

## 원인1. mysql에서는 잘되었던 querydsl 쿼리가 h2에서는 NumberFormatException이 발생했다.

### 에러를 처리하기 위한 생각의 흐름
- exception만 보면 jdbc에서 ResultSet시 int가 들어가야 할 자리에 String이 들어가 문제가 발생했다고 판단.
- data binding이 h2 dialect에서는 잘 안된걸로 판단.
- 에러시점부터 코드를 추적했지만 도저히 파악할수 없어서 쿼리단부터 문제가 될만한 것들을 하나씩 소거하면서 에러원인과 해결법을 찾기 시작했다. 

문제의 코드
```java

public List<Team> findTeamsByMatchIds(String... matchId) {
    return jpaQueryFactory.selectFrom(team)
            .leftJoin(team.bans)
            .fetchJoin()
            .where(team.matchId.in(matchId))
            .fetch();
}

```

팀 엔터티와 밴 엔터티는 1:N, N:1 관계이다.
```java
@Entity
public class Team {
  ... 생략

    @OneToMany
    @JoinColumns(value = {
            @JoinColumn(name = "match_id", insertable = false, updatable = false),
            @JoinColumn(name = "team_id", insertable = false, updatable = false)
    })
    private List<Ban> bans;
}

```

해결한 코드
```java
  public List<Team> findTeamsByMatchIds(String... matchId) {
      return jpaQueryFactory.selectFrom(team)
              .leftJoin(ban)
              .on(team.matchId.eq(ban.matchId))
              .on(team.teamId.eq(ban.teamId))
              .fetchJoin()
              .where(team.matchId.in(matchId))
              .fetch();
  }
```





