# 제6장 다양한 연관관계 매핑

## 다대일(N:1, @ManyToOne)
- 양방향은 외래 키가 있는 쪽이 연관관계의 주인이다.
- 일대다와 다대일 연관관계는 항상 다(N)에 외래 키가 있다.
- 양방향 연관관계는 항상 서로를 참조해야 한다.
- 서로 참조하게 하려면 연관관계 편의 메소드를 작성하는 것이 좋은데 무한루프에 빠지지 않도록 검사하는 로직이 있어야 한다.

## 일대다
- 자바 컬렌션인 Collection, List, Set, Map 중에 하나를 사용해야 한다.
- <ins>일대다 단방향 관계를 매핑할 때는 @JoinColumn을 명시해야 한다. 그렇지 않으면 JPA는 연결 테이블을 중간에 두고 연관관계르르 관리하는 조인 테이블 전략을 기본으로 사용해서 매핑한다.</ins>
- 일대다 단방향 매핑의 단점은 매핑한 객체가 관리하는 외래 키가 다른 테이블에 있다는 점이다.
- 일대다 단방향 매핑보다는 다대일 양방향 매핑을 사용하자

## 일대일(1:1)
- 일대일 관계는 주 테이블이나 대상 테이블 둘 중 어느 곳이나 외래 키를 가질 수 있다.

### 주 테이블에 외래 키
**단방향**
- MEMBER가 주 테이블이고 LOCKER는 대상 테이블이다.


### 대상 테이블에 외래 키
-

## 다대다(N:N)
- 관계형 데이터베이스는 정규화된 테이블 2개로 다대다 관계를 표현할 수 없다. 그래서 보통 다대다 관계를 일대다, 다대일 관계로 풀어내는 연결 테이블을 사용한다.
- 그런데 객체는 테이블과 다르게 객체 2개로 다대다 관게를 만들 수 있다.

### 다대다: 단방향
```java
@Entity
public class Member{
  @Id @Column(name = "MEMBER_ID")
  private String id;
  private String username;

  @ManyToMany
  @JoinTable(name = "MEMBER_PRODUCT",
        joinColumns = @JoinColumn(name = "MEMBER_ID"),
        inverseJoinColumns = @JoinColumn(name = "PRODUCT_ID"))
  private List<Product> products;
  ...
}
```

```java
@Entity
public class Product {
    @Id @Column(name = "PRODUCT_ID")
    private String id;

    private String name;
}
```




